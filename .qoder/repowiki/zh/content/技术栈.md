# 技术栈

<cite>
**本文档中引用的文件**  
- [main.ts](file://apps/backend/src/main.ts)
- [auth.service.ts](file://apps/backend/src/auth/auth.service.ts)
- [prisma.service.ts](file://apps/backend/src/prisma/prisma.service.ts)
- [redis.service.ts](file://apps/backend/src/redis/redis.service.ts)
- [scheduled-tasks.processor.ts](file://apps/backend/src/scheduled-tasks/scheduled-tasks.processor.ts)
- [jwt.strategy.ts](file://apps/backend/src/auth/jwt.strategy.ts)
- [auth.schema.ts](file://packages/shared/src/schemas/auth.schema.ts)
- [main.ts](file://apps/frontend/src/main.ts)
- [auth.ts](file://apps/frontend/src/stores/auth.ts)
- [useRequest.ts](file://apps/frontend/src/composables/useRequest.ts)
- [api/index.ts](file://apps/frontend/src/api/index.ts)
- [capacitor.config.ts](file://apps/frontend/capacitor.config.ts)
- [electron/main.ts](file://apps/frontend/electron/main.ts)
- [electron-builder.json](file://apps/frontend/electron-builder.json)
- [package.json](file://apps/backend/package.json)
- [package.json](file://apps/frontend/package.json)
- [package.json](file://packages/shared/package.json)
- [package.json](file://package.json)
</cite>

## 目录
1. [后端技术栈](#后端技术栈)
2. [前端技术栈](#前端技术栈)
3. [跨端技术栈](#跨端技术栈)
4. [共享类型与验证](#共享类型与验证)

## 后端技术栈

本项目后端采用 NestJS 框架构建，结合 Prisma ORM、Redis 缓存、BullMQ 任务队列、JWT 认证等技术，形成高效、安全、可扩展的服务架构。

### NestJS 框架
NestJS 是一个基于 TypeScript 的渐进式 Node.js 框架，采用模块化、依赖注入和面向切面的编程思想，提供清晰的分层结构。其与 Express 兼容，并支持微服务和 WebSocket，适合构建企业级应用。当前项目已升级至 NestJS 10.4+ 版本，利用其最新的性能优化和模块系统改进。

在 `main.ts` 中，通过 `NestFactory.create()` 创建应用实例，并配置全局前缀、安全中间件（如 Helmet）、CORS、压缩、日志等，体现了其强大的可配置性与扩展能力。

**Section sources**
- [main.ts](file://apps/backend/src/main.ts#L1-L94)

### Prisma ORM
Prisma 是现代化的 Node.js 与 TypeScript 数据库工具，提供类型安全的数据库访问。项目中通过 `PrismaService` 继承 `PrismaClient` 并实现 `OnModuleInit` 和 `OnModuleDestroy` 接口，确保连接的生命周期管理。当前项目已升级至 Prisma 6 版本，增强了对 PostgreSQL 适配器的支持，并提升了生成代码的类型安全性。

Prisma Schema 定义在 `prisma/schema.prisma` 中，通过 `prisma generate` 自动生成类型，实现数据库操作的类型安全。

**Section sources**
- [prisma.service.ts](file://apps/backend/src/prisma/prisma.service.ts#L1-L20)

### Redis 缓存
Redis 用于缓存高频访问数据，提升系统性能。项目中通过 `@nestjs/cache-manager` 集成 `ioredis`，并封装 `RedisService` 提供统一的缓存操作接口，支持前缀管理、TTL 设置、命名空间等高级功能。

`RedisService` 实现了 `get`、`set`、`del`、`getOrSet` 等方法，并通过 `NamespacedCache` 支持按模块隔离缓存，避免键冲突。

**Section sources**
- [redis.service.ts](file://apps/backend/src/redis/redis.service.ts#L1-L232)

### BullMQ 任务队列
BullMQ 是基于 Redis 的高性能 Node.js 任务队列，用于处理异步任务。项目中通过 `@nestjs/bullmq` 模块集成，定义 `ScheduledTasksProcessor` 处理器，支持健康检查、数据清理、统计报表等定时任务。当前项目已升级至 BullMQ 5 版本，提升了任务处理的稳定性和监控能力。

任务通过 `Job` 对象传递，支持事件监听（如 `completed`、`failed`），便于监控与错误处理。

**Section sources**
- [scheduled-tasks.processor.ts](file://apps/backend/src/scheduled-tasks/scheduled-tasks.processor.ts#L1-L74)

### JWT 认证
JWT（JSON Web Token）用于实现无状态认证。项目中使用 `@nestjs/passport` 与 `passport-jwt` 构建认证策略，通过 `JwtStrategy` 验证令牌，并在 `AuthService` 中生成访问令牌与刷新令牌。

令牌包含用户 ID 和邮箱，类型分为 `access` 和 `refresh`，分别设置不同的过期时间（默认 15 分钟和 7 天），实现安全的会话管理。

**Section sources**
- [auth.service.ts](file://apps/backend/src/auth/auth.service.ts#L1-L150)
- [jwt.strategy.ts](file://apps/backend/src/auth/jwt.strategy.ts#L1-L47)
- [jwt-auth.guard.ts](file://apps/backend/src/auth/jwt-auth.guard.ts#L1-L10)

## 前端技术栈

前端采用 Vue 3 生态，结合 Vite、Pinia、Tailwind CSS 等现代工具链，构建高性能、可维护的用户界面。

### Vue 3 Composition API
Vue 3 的 Composition API 提供更灵活的逻辑组织方式，支持逻辑复用与类型推断。项目中通过 `setup()` 函数和 `ref`、`computed` 等响应式 API 构建组件逻辑。当前项目已升级至 Vue 3.5+ 版本，增强了响应式系统的性能和开发体验。

例如，在 `useRequest` 组合式函数中，封装了请求的加载、数据、错误状态，提升代码复用性。

**Section sources**
- [useRequest.ts](file://apps/frontend/src/composables/useRequest.ts#L1-L44)

### Vite 构建工具
Vite 是新一代前端构建工具，基于 ES 模块和原生浏览器支持，提供极快的冷启动和热更新。项目中通过 `vite.config.ts` 配置开发服务器、构建输出等，支持 TypeScript、Vue 单文件组件等。当前项目已升级至 Vite 6 版本，优化了构建性能和插件生态兼容性。

开发时通过 `vite` 命令启动，生产构建使用 `vite build`，结合 `vue-tsc` 进行类型检查。

**Section sources**
- [package.json](file://apps/frontend/package.json#L8-L10)

### Pinia 状态管理
Pinia 是 Vue 官方推荐的状态管理库，替代 Vuex，提供更简洁的 API 和更好的 TypeScript 支持。项目中通过 `defineStore` 创建 `useAuthStore`，管理用户认证状态（token、用户信息、加载状态等）。

结合 `pinia-plugin-persistedstate` 插件，将 token 持久化到本地存储，实现页面刷新后状态保留。

**Section sources**
- [auth.ts](file://apps/frontend/src/stores/auth.ts#L1-L97)

### TanStack Query
TanStack Query（原 React Query）在 Vue 中通过 `@tanstack/vue-query` 提供强大的数据获取与缓存管理能力。项目中在 `main.ts` 中配置 `QueryClient`，并在组件中使用 `useQuery` 实现自动缓存、背景更新和错误重试。当前项目已集成 TanStack Query 5 版本，提升了类型安全性和查询性能。

例如，在 `HomeView.vue` 中使用 `useQuery` 获取用户列表，并自动处理加载和错误状态。

**Section sources**
- [main.ts](file://apps/frontend/src/main.ts#L38-L46)
- [HomeView.vue](file://apps/frontend/src/views/HomeView.vue#L117-L127)

### Tailwind CSS 与 shadcn-vue
Tailwind CSS 是实用优先的 CSS 框架，通过类名直接编写样式，提升开发效率。项目中通过 `tailwind.config.js` 配置主题、插件等。

shadcn-vue 是基于 Tailwind 的可复用 UI 组件库，项目中通过 `components.json` 管理组件，结合 `lucide-vue-next` 图标库，快速构建美观界面。

**Section sources**
- [tailwind.config.js](file://apps/frontend/tailwind.config.js)
- [components.json](file://apps/frontend/components.json)

## 跨端技术栈

项目通过 Capacitor 和 Electron 实现多平台部署，覆盖移动端（iOS/Android）和桌面端（Windows/macOS/Linux）。

### Capacitor
Capacitor 是 Ionic 团队开发的跨平台应用容器，允许 Web 应用访问原生设备功能（如相机、文件系统）。项目中通过 `@capacitor/cli` 管理原生项目，`capacitor.config.ts` 配置应用 ID、名称、Web 目录等。

通过 `cap sync` 同步 Web 构建产物到原生项目，`cap run` 直接运行原生应用，支持热重载。

**Section sources**
- [capacitor.config.ts](file://apps/frontend/capacitor.config.ts#L1-L23)

### Electron
Electron 用于构建桌面应用，结合 Chromium 和 Node.js。项目中通过 `electron/main.ts` 配置主进程，创建 `BrowserWindow` 加载前端页面。

支持开发模式（加载 Vite 服务器）和生产模式（加载打包文件），并通过 `electron-builder` 打包为各平台安装包。

本项目已更新 Electron 构建工具 `electron-builder` 从 26.0.0 到 26.0.12 版本，以确保与现代 Node.js 版本的兼容性。构建配置在 `electron-builder.json` 文件中定义，支持多平台打包，包括 macOS（DMG、ZIP）、Windows（NSIS 安装程序、便携版）和 Linux（AppImage、DEB）。

此外，项目在根目录的 `package.json` 中通过 `pnpm` 的 `overrides` 功能固定了 `@electron/rebuild` 版本为 4.0.2，解决了 Electron 原生模块重建的兼容性问题，确保了构建过程的稳定性和可重复性。

**Section sources**
- [electron/main.ts](file://apps/frontend/electron/main.ts#L1-L95)
- [electron-builder.json](file://apps/frontend/electron-builder.json)
- [package.json](file://apps/frontend/package.json#L64)
- [package.json](file://package.json#L51-L53)

## 共享类型与验证

项目通过 Zod Schema 在前后端之间实现类型共享和验证统一。在 `packages/shared` 中定义 `auth.schema.ts` 等 Zod 模式，用于请求验证和响应类型定义。后端使用 `nestjs-zod` 将 Zod 模式集成到 NestJS 管道中，前端使用 `@vee-validate/zod` 进行表单验证，确保类型一致性。

**Section sources**
- [auth.schema.ts](file://packages/shared/src/schemas/auth.schema.ts)
- [main.ts](file://apps/backend/src/main.ts#L66)
- [HomeView.vue](file://apps/frontend/src/views/HomeView.vue#L6-L7)